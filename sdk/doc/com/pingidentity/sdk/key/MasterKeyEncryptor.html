<!DOCTYPE HTML>
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (11.0.20) on Thu Apr 18 20:24:00 UTC 2024 -->
<title>MasterKeyEncryptor (PingFederate Server SDK)</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="dc.created" content="2024-04-18">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../jquery/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../../../../script.js"></script>
<script type="text/javascript" src="../../../../jquery/jszip/dist/jszip.min.js"></script>
<script type="text/javascript" src="../../../../jquery/jszip-utils/dist/jszip-utils.min.js"></script>
<!--[if IE]>
<script type="text/javascript" src="../../../../jquery/jszip-utils/dist/jszip-utils-ie.min.js"></script>
<![endif]-->
<script type="text/javascript" src="../../../../jquery/jquery-3.6.1.min.js"></script>
<script type="text/javascript" src="../../../../jquery/jquery-ui.min.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="MasterKeyEncryptor (PingFederate Server SDK)";
        }
    }
    catch(err) {
    }
//-->
var data = {"i0":6,"i1":6,"i2":6};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],4:["t3","Abstract Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
var pathtoroot = "../../../../";
var useModuleDirectories = true;
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<header role="banner">
<nav role="navigation">
<div class="fixedNav">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a id="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/MasterKeyEncryptor.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../allclasses.html">All&nbsp;Classes</a></li>
</ul>
<ul class="navListSearch">
<li><label for="search">SEARCH:</label>
<input type="text" id="search" value="search" disabled="disabled">
<input type="reset" id="reset" value="reset" disabled="disabled">
</li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a id="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
</div>
<div class="navPadding">&nbsp;</div>
<script type="text/javascript"><!--
$('.navPadding').css('padding-top', $('.fixedNav').css("height"));
//-->
</script>
</nav>
</header>
<!-- ======== START OF CLASS DATA ======== -->
<main role="main">
<div class="header">
<div class="subTitle"><span class="packageLabelInType">Package</span>&nbsp;<a href="package-summary.html">com.pingidentity.sdk.key</a></div>
<h2 title="Interface MasterKeyEncryptor" class="title">Interface MasterKeyEncryptor</h2>
</div>
<div class="contentContainer">
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<pre>public interface <span class="typeNameLabel">MasterKeyEncryptor</span></pre>
<div class="block"><p>
 An encryptor that can be used to encrypt PingFederate's master key file (pf.jwk).
 </p>
 <p>
 The encryptor can return a key identifier (via its initialize method) which can
 be associated with the master key file. This allows PingFederate configuration
 archives to be transferred between different installations. Alternatively, a null
 key identifier can be returned if the encryptor chooses to manage its key identifier
 for certain deployment requirements, such as tying the key to the machine's MAC
 address.
</p>
<p>
 If a master key file was previously unencrypted, it will be immediately
 encrypted after initialization. If a key identifier is returned and has changed,
 then the master key file be decrypted and then encrypted immediately after to
 allow the encryptor to apply the new key.
 </p>
 <p>
 The key identifier is stored in the
 '&lt;PF_INSTALL&gt;/pingfederate/server/default/data/config-store/com.pingidentity.crypto.jwk.MasterKeySet.xml'
 file.
 </p>
 <p>
 An encryptor implementation must be deployed to the directory
 '&lt;PF_INSTALL&gt;/pingfederate/server/default/deploy/' and declared for use in
 '&lt;PF_INSTALL&gt;/pingfederate/server/default/conf/service-points.conf', by updating the value of
 master.key.encryptor. i.e.
 </p>
 <pre>
 <code>
     master.key.encryptor=com.company.MyMasterKeyEncryptor
 </code>
 </pre>
 <h3>Disabling Revocation Checking</h3>
 <p>
 A circular initialization dependency can arise if revocation checking is enabled in PingFederate
 and a <code>MasterKeyEncryptor</code> implementation makes API calls to an external service. To
 avoid this risk, revocation checking should be disabled for any API calls made by the master key
 encryptor. The following code shows how a custom trust manager can be created that uses the trust
 anchors from Java's <code>cacerts</code> file and has revocation checking disabled.
 </p>
 <pre>
     private static TrustManager[] getCaCertsTrustManagers()
     {
         String javaHome = System.getProperty("java.home");
         if (javaHome == null)
         {
             throw new IllegalStateException("Expected java.home system property to be set");
         }

         Path cacerts = Paths.get(javaHome).resolve(Paths.get("lib/security/cacerts"));

         try (InputStream inputStream = Files.newInputStream(cacerts))
         {
             KeyStore ks = KeyStore.getInstance("JKS");
             ks.load(inputStream, null);

             TrustManagerFactory trustManagerFactory =
                     TrustManagerFactory.getInstance(TrustManagerFactory.getDefaultAlgorithm());

             PKIXBuilderParameters params = new PKIXBuilderParameters(ks, new X509CertSelector());
             params.setRevocationEnabled(false);
             trustManagerFactory.init(new CertPathTrustManagerParameters(params));

             return trustManagerFactory.getTrustManagers();
         }
         catch (IOException | GeneralSecurityException e)
         {
             throw new IllegalStateException("Failed to create trust manager", e);
         }
     }
 </pre></div>
<dl>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>8.0</dd>
</dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ========== METHOD SUMMARY =========== -->
<section>
<ul class="blockList">
<li class="blockList"><a id="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t3" class="tableTab"><span><a href="javascript:show(4);">Abstract Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colSecond" scope="col">Method</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>byte[]</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#decrypt(byte%5B%5D)">decrypt</a></span>&#8203;(byte[]&nbsp;cipherText)</code></th>
<td class="colLast">
<div class="block">Decrypts the master key's cipher text.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>byte[]</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#encrypt(byte%5B%5D)">encrypt</a></span>&#8203;(byte[]&nbsp;plainText)</code></th>
<td class="colLast">
<div class="block">Encrypts the data that will eventually be stored in the master key file.</div>
</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html?is-external=true" title="class or interface in java.lang" class="externalLink">String</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#initialize(java.lang.String)">initialize</a></span>&#8203;(<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html?is-external=true" title="class or interface in java.lang" class="externalLink">String</a>&nbsp;keyId)</code></th>
<td class="colLast">
<div class="block">
 Initializes the <code>MasterKeyEncryptor</code> allowing implementations
 to perform any external key management operations, such as creating/loading
 an external key.</div>
</td>
</tr>
</table>
</li>
</ul>
</section>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ METHOD DETAIL ========== -->
<section>
<ul class="blockList">
<li class="blockList"><a id="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a id="initialize(java.lang.String)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>initialize</h4>
<pre class="methodSignature"><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html?is-external=true" title="class or interface in java.lang" class="externalLink">String</a>&nbsp;initialize&#8203;(<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html?is-external=true" title="class or interface in java.lang" class="externalLink">String</a>&nbsp;keyId)
           throws <a href="MasterKeyEncryptorException.html" title="class in com.pingidentity.sdk.key">MasterKeyEncryptorException</a></pre>
<div class="block"><p>
 Initializes the <code>MasterKeyEncryptor</code> allowing implementations
 to perform any external key management operations, such as creating/loading
 an external key.
 </p>
 <p>
 The key identifier that is used to encrypt/decrypt the master key file is
 passed into the initialize method. The key identifier may be null if the
 master key file was not previously encrypted, or if this <code>MasterKeyEncryptor</code>
 doesn't need a key identifier and previously returned null in an earlier
 initialization.
 </p>
 <p>
 This method is called everytime a master key file is loaded. This can occur when
 PingFederate starts up or when a configuration archive is imported.
 </p></div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>keyId</code> - The key identifier associated with the master key file. May be null.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The key identifier to associate with the master key file. Can be null.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="MasterKeyEncryptorException.html" title="class in com.pingidentity.sdk.key">MasterKeyEncryptorException</a></code> - Thrown if failed to initialize.</dd>
</dl>
</li>
</ul>
<a id="encrypt(byte[])">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>encrypt</h4>
<pre class="methodSignature">byte[]&nbsp;encrypt&#8203;(byte[]&nbsp;plainText)
        throws <a href="MasterKeyEncryptorException.html" title="class in com.pingidentity.sdk.key">MasterKeyEncryptorException</a></pre>
<div class="block">Encrypts the data that will eventually be stored in the master key file.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>plainText</code> - The master key file's plain text content.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The cipher text that will be saved to the master key file.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="MasterKeyEncryptorException.html" title="class in com.pingidentity.sdk.key">MasterKeyEncryptorException</a></code> - Thrown if failed to encrypt.</dd>
</dl>
</li>
</ul>
<a id="decrypt(byte[])">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>decrypt</h4>
<pre class="methodSignature">byte[]&nbsp;decrypt&#8203;(byte[]&nbsp;cipherText)
        throws <a href="MasterKeyEncryptorException.html" title="class in com.pingidentity.sdk.key">MasterKeyEncryptorException</a></pre>
<div class="block">Decrypts the master key's cipher text.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>cipherText</code> - The master key's cipher text.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The plain text contents of the master key file.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="MasterKeyEncryptorException.html" title="class in com.pingidentity.sdk.key">MasterKeyEncryptorException</a></code> - Thrown if failed to decrypt.</dd>
</dl>
</li>
</ul>
</li>
</ul>
</section>
</li>
</ul>
</div>
</div>
</main>
<!-- ========= END OF CLASS DATA ========= -->
<footer role="contentinfo">
<nav role="navigation">
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a id="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/MasterKeyEncryptor.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../allclasses.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a id="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</nav>
<p class="legalCopy"><small>© Copyright 2024 Ping Identity. All rights reserved.</small></p>
</footer>
</body>
</html>
